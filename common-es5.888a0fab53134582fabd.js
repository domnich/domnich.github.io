!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkcloudya=self.webpackChunkcloudya||[]).push([[68592],{16492:function(t,i,o){o.d(i,{T:function(){return u},l:function(){return a}});var s,r=o(37716),u=((s=function(){function t(){e(this,t)}return n(t,[{key:"transform",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;return e&&(Array.isArray(t)?this.multiExpressionTransform(e,t,n,i,o):Array.isArray(e)?this.sortArray(e.slice(),t,n,i,o):"object"==typeof e?this.transformObject(Object.assign({},e),t,n,i,o):e)}},{key:"sortArray",value:function(e,n,i,o,s){var r,u=n&&-1!==n.indexOf(".");u&&(n=t.parseExpression(n)),r=s&&"function"==typeof s?s:o?t.caseInsensitiveSort:t.defaultCompare;var a=e.sort(function(e,i){return n?u?r(t.getValue(e,n),t.getValue(i,n)):e&&i?r(e[n],i[n]):r(e,i):r(e,i)});return i?a.reverse():a}},{key:"transformObject",value:function(e,n,i,o,s){var r=t.parseExpression(n),u=r.pop(),a=t.getValue(e,r);return Array.isArray(a)||(r.push(u),u=null,a=t.getValue(e,r)),a&&t.setValue(e,this.transform(a,u,i,o),r),e}},{key:"multiExpressionTransform",value:function(e,t,n){var i=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4?arguments[4]:void 0;return t.reverse().reduce(function(e,t){return i.transform(e,t,n,o,s)},e)}}],[{key:"isString",value:function(e){return"string"==typeof e||e instanceof String}},{key:"caseInsensitiveSort",value:function(e,n){return t.isString(e)&&t.isString(n)?e.localeCompare(n):t.defaultCompare(e,n)}},{key:"defaultCompare",value:function(e,t){return e===t?0:null==e?1:null==t?-1:e>t?1:-1}},{key:"parseExpression",value:function(e){return(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split(".")}},{key:"getValue",value:function(e,t){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(!(o in e))return;e=e[o]}return e}},{key:"setValue",value:function(e,t,n){var i;for(i=0;i<n.length-1;i++)e=e[n[i]];e[n[i]]=t}}]),t}()).\u0275fac=function(e){return new(e||s)},s.\u0275pipe=r.Yjl({name:"orderBy",type:s,pure:!1}),s),a=function(){var t=n(function t(){e(this,t)});return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({providers:[u]}),t}()},43982:function(t,i,o){o.d(i,{Q:function(){return _}});var s,r=o(11740),u=o(28123),a=((s=a||(a={})).Austria="at",s.Belgium="be",s.Bulgaria="bg",s.Switzerland="ch",s.Germany="de",s.Denmark="dk",s.Spain="es",s.France="fr",s.UnitedKingdom="gb",s.Croatia="hr",s.Hungary="hu",s.Ireland="ie",s.India="in",s.Italy="it",s.Netherlands="nl",s.Poland="pl",s.Portugal="pt",s.Romania="ro",s.Sweden="se",s.Slovenia="si",s.USA="us",a),c={busy:{busyToneState:!0,volume:.25,busyTones:{gb:{frequency:400,latency:375,autoCloseDuration:4650},de:{frequency:425,latency:480,autoCloseDuration:4525}},currentTone:a.UnitedKingdom,toneSegment:{segmentFrequencies:[950,1400,1800],segmentsDuration:330,segmentsInterval:30}}},l=o(71188),h=o(46782),y=o(79765),d=o(68260),f=o(37716),v=o(22238),p=o(78023),g=o(29790),m=function(){var t=function(){function t(n){e(this,t),this.dialogRef=n}return n(t,[{key:"closeDialog",value:function(){this.dialogRef.close()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(f.Y36(v.so))},t.\u0275cmp=f.Xpm({type:t,selectors:[["autoplay-policy"]],decls:7,vars:6,consts:[[1,"autoplay-policy__header"],[1,"autoplay-policy__body"],["buttonTextTranslationKey","autoplay_policy.button","type","stroked-button-submit","data-e2e","autoplay-policy-fragment__confirm--button",1,"autoplay-policy__button",3,"appButtonClick"]],template:function(e,t){1&e&&(f.TgZ(0,"div",0),f._uU(1),f.ALo(2,"translate"),f.qZA(),f.TgZ(3,"div",1),f._uU(4),f.ALo(5,"translate"),f.qZA(),f.TgZ(6,"app-button",2),f.NdJ("appButtonClick",function(){return t.closeDialog()}),f.qZA()),2&e&&(f.xp6(1),f.hij(" ",f.lcZ(2,2,"autoplay_policy.title"),"\n"),f.xp6(3),f.hij(" ",f.lcZ(5,4,"autoplay_policy.text"),"\n"))},directives:[p.V],pipes:[g.X$],styles:[".autoplay-policy__header[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:bold}.autoplay-policy__body[_ngcontent-%COMP%]{font-size:1.4rem;margin:1.6rem 0 2.5rem}.autoplay-policy__button[_ngcontent-%COMP%]{float:right}"]}),t}(),b=o(81836),S=o(8225),T=o(51233),k=o(14074),x=o(57158),A=o(45832),C=o(8307),w=o(25791),_=function(){var t=function(){function t(n,i,o,s,r,u,a,c,l){e(this,t),this.sipService=n,this.devicesService=i,this.userService=o,this.setCallbackOnBusyService=s,this.logger=r,this.dialog=u,this.snackBarService=a,this.router=c,this.guestService=l,this.osc=null,this.audioEl=new Audio,this.ngUnsubscribe=new y.xQ,this.isStoppingSitTone=!1,this.userExtension="",this.currentSegment=0,this.ctx=new(window.AudioContext||window.webkitAudioContext),this.busyToneState=!0,this.msd=this.ctx.createMediaStreamDestination(),this.checkAudioContextState()}return n(t,[{key:"ngOnDestroy",value:function(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}},{key:"initIncoming",value:function(){this.ringtone&&this.isRingTonePlaying()&&this.ringtone.pause(),this.loadRingtone(),l.V.ringerActive&&this.ringtone.play(),this.setCallbackOnBusyService.removeCallbackOnBusy()}},{key:"openContextAndCreateMsd",value:function(){this.ctx=new AudioContext,this.msd=this.ctx.createMediaStreamDestination()}},{key:"initBusy",value:function(e){var t=this;this.resetBusyTone(),this.openContextAndCreateMsd(),this.busyToneInterval=setInterval(function(){t.startBusyTone(t.busyToneState)},c.busy.busyTones[c.busy.currentTone].latency),this.userExtension=e,this.busyToneTimeout=setTimeout(function(){t.resetBusyTone()},c.busy.busyTones[c.busy.currentTone].autoCloseDuration)}},{key:"initFailure",value:function(e,t){this.userExtension=t,this.currentSegment=0,(null==e?void 0:e.statusCode)===d.i.TEMPORARILY_UNAVAILABLE?this.initBusy(this.userExtension):this.startSitTone()}},{key:"preloadAudio",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=["assets/audio/Munich.mp3","assets/audio/call-waiting.wav"],i=new Audio(n[t]),o=function o(){i.removeEventListener("canplaythrough",o),t<=n.length-1&&e.preloadAudio(++t)};i.load(),i.addEventListener("canplaythrough",o,!1)}},{key:"loadRingtone",value:function(){var e=this;this.ringtone=new Audio,this.ringtone.loop=!0,this.ringtone.src=this.sipService.onGoingCall?"assets/audio/call-waiting.wav":"assets/audio/Munich.mp3",this.ringtone.load(),this.setRingtoneVolumeFromCache(this.ringtone),this.userService.userInfo$.pipe((0,h.R)(this.ngUnsubscribe)).subscribe(function(t){if(t){e.userExtension=t.activePhoneExtension.extensionNumber;var n=e.devicesService.loadStoredRingerOutputDevice();e.logger.info(n),n&&(r.W.attachSinkId(e.ringtone,n.deviceId,e.logger),e.ringtone&&e.setRingtoneVolumeFromCache(e.ringtone))}})}},{key:"stopRingTone",value:function(){this.ringtone.pause()}},{key:"startBusyTone",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e)this.osc=this.ctx.createOscillator(),this.osc.frequency.setValueAtTime(c.busy.busyTones[c.busy.currentTone].frequency,this.ctx.currentTime),this.setAudioSourceForBusyOrSitTone(),this.osc.start(this.ctx.currentTime);else{if(!this.osc)return;this.osc.stop(this.ctx.currentTime),this.osc=null}this.busyToneState=!this.busyToneState}},{key:"startSitTone",value:function(){var e,t,n,i=this,o=c.busy.toneSegment.segmentFrequencies,s=o[this.currentSegment];this.openContextAndCreateMsd(),this.osc=this.ctx.createOscillator(),null===(t=null===(e=this.osc)||void 0===e?void 0:e.frequency)||void 0===t||t.setValueAtTime(s,this.ctx.currentTime),this.setAudioSourceForBusyOrSitTone(),null===(n=this.osc)||void 0===n||n.start(this.ctx.currentTime),setTimeout(function(){i.osc&&(i.osc.stop(i.ctx.currentTime),i.osc=null),i.closeAudioContext(),i.currentSegment++,i.currentSegment<o.length&&!i.isStoppingSitTone&&i.startSitTone()},c.busy.toneSegment.segmentsDuration)}},{key:"stopPlayingSitTone",value:function(){this.isStoppingSitTone=!0}},{key:"closeAudioContext",value:function(){this.ctx&&"closed"!==this.ctx.state&&this.ctx.close()}},{key:"resetBusyTone",value:function(){clearInterval(this.busyToneInterval),clearTimeout(this.busyToneTimeout),this.startBusyTone(!1)}},{key:"setAudioSourceForBusyOrSitTone",value:function(){this.osc.connect(this.msd),this.audioEl.srcObject=this.msd.stream,this.setRingtoneVolumeFromCache(this.audioEl,c.busy.volume),this.audioEl.volume=.2,this.audioEl.play();var e=this.devicesService.loadStoredAudioOutputDevice();r.W.attachSinkId(this.audioEl,e?e.deviceId:"",this.logger)}},{key:"isRingTonePlaying",value:function(){return!this.ringtone.paused}},{key:"setRingtoneVolumeFromCache",value:function(e,t){var n=this.devicesService.loadStoredRingerOutputDevice();if(this.logger.info(n),n){var i=u.Q.getCached("ringtoneVolumes-"+this.userExtension,[]);if(i){var o=i.find(function(e){return e.label===n.label});o&&(e.volume=o.value*(t||1))}}}},{key:"toggleAutoplayPolicyComponent",value:function(){var e=this;this.dialog.open(m,{width:"28rem",autoFocus:!1,panelClass:"autoplay-policy"}).afterClosed().subscribe(function(){e.snackBarService.openInfo("autoplay_policy.sound_enabled")})}},{key:"checkAudioContextState",value:function(){var e="localhost"===window.location.hostname,t=this.router.url.includes("login"),n=this.guestService.isGuest();e||t||n||"suspended"===this.ctx.state&&this.toggleAutoplayPolicyComponent()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(f.LFG(b.y),f.LFG(S.I),f.LFG(T.K),f.LFG(k.q),f.LFG(x.Kf),f.LFG(v.uw),f.LFG(A.c),f.LFG(C.F0),f.LFG(w.Q))},t.\u0275prov=f.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()},7685:function(t,i,o){o.d(i,{_:function(){return s}});var s=function(){function t(){e(this,t)}return n(t,null,[{key:"password",value:function(){return function(e){return e.value&&!e.value.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!"#$%()*+,-./;<@\'_])[A-Za-z\d!"#$%()*+,-./;<@\'_]{8,}$/)?{invalidPassword:!0}:null}}}]),t}()}}])}();