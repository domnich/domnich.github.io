!function(){"use strict";function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){s=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */n=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(x){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,o=Object.create(i.prototype),a=new I(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return U()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,a),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(x){return{type:"throw",arg:x}}}e.wrap=c;var f={};function p(){}function d(){}function l(){}var v={};u(v,o,function(){return this});var g=Object.getPrototypeOf,w=g&&g(g(L([])));w&&w!==t&&r.call(w,o)&&(v=w);var y=l.prototype=p.prototype=Object.create(v);function R(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){function n(i,o,a,s){var u=h(e[i],e,o);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(f).then(function(e){c.value=e,a(c)},function(e){return n("throw",e,a,s)})}s(u.arg)}var i;this._invoke=function(e,r){function o(){return new t(function(t,i){n(e,r,t,i)})}return i=i?i.then(o,o):o()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=h(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function m(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(m,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:U}}function U(){return{value:void 0,done:!0}}return d.prototype=l,u(y,"constructor",l),u(l,"constructor",d),d.displayName=u(l,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,u(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},R(k.prototype),u(k.prototype,a,function(){return this}),e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new k(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},R(y),u(y,s,"Generator"),u(y,o,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(self.webpackChunkcloudya=self.webpackChunkcloudya||[]).push([[52404],{52404:function(t,i,a){a.r(i),a.d(i,{initHandler:function(){return x}});var s=a(30281);function u(e,t){return t?function(n){return(0,s.c)(t.pipe((0,s.t)(1),(0,s.o)(function(e,t){e.subscribe(new s.O(t,s.n))})),n.pipe(u(e)))}:(0,s.a)(function(t,n){return e(t,n).pipe((0,s.t)(1),(r=t,(0,s.m)(function(){return r})));var r})}function c(e,t){void 0===t&&(t=s.d);var n=(0,s.b)(e,t);return u(function(){return n})}var h=function(){function e(){r(this,e)}return o(e,null,[{key:"rawUsageFrom",value:function(e,t){return(e<<16|t)>>>0}},{key:"usagePageFromRaw",value:function(e){return e>>>16}},{key:"usageFromRaw",value:function(e){return e<<16>>>16}}]),e}(),f=function(){function e(t){var n=this;r(this,e),this.devices=new Map,this.deviceInputSubscriptions=new Map,this.onHidInput=new s.S,this.onGetFeatureReportResponse=new s.S;var i=new s.S;this.deviceAdded=i;var o=new s.S;this.deviceRemoved=o,t.deviceAdded.subscribe(function(e){if(!n.devices.has(e.id)){n.devices.set(e.id,e);var t=e.inputHandler.inputReports.pipe((0,s.m)(function(t){return new s.W(e.id,h.usagePageFromRaw(t.usage),h.usageFromRaw(t.usage),t.value)})).subscribe(function(e){return n.onHidInput.next(e)});n.deviceInputSubscriptions.set(e.id,t),i.next(e)}}),t.deviceRemoved.subscribe(function(e){var t,r=n.devices.get(e);r&&(n.devices.delete(e),null===(t=n.deviceInputSubscriptions.get(e))||void 0===t||t.unsubscribe(),n.deviceInputSubscriptions.delete(e),o.next(r))})}return o(e,[{key:"sendOutputUsage",value:function(e,t,n,r){var i,o=h.rawUsageFrom(t,n);null===(i=this.devices.get(e))||void 0===i||i.outputHandler.sendOutputUsage(o,r)}},{key:"setFeatureUsage",value:function(e,t,n,r){var i,o=h.rawUsageFrom(t,n);null===(i=this.devices.get(e))||void 0===i||i.featureHandler.setFeatureUsage(o,r)}},{key:"getFeatureUsage",value:function(e,t,r,i){var o;return(0,s._)(this,void 0,void 0,n().mark(function a(){var u,c;return n().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return u=h.rawUsageFrom(r,i),n.next=3,null===(o=this.devices.get(e))||void 0===o?void 0:o.featureHandler.getFeatureUsage(u);case 3:void 0!==(c=n.sent)&&this.onGetFeatureReportResponse.next(new s.e(t,c));case 5:case"end":return n.stop()}},a,this)}))}}]),e}(),p=function(){function t(e,n){var i=this;r(this,t),this.device=e,this.inputReportDescriptors=n;var o=new Map;this.inputReportDescriptors.forEach(function(e){e.usages.forEach(function(e,t){o.set(t,[0])})});var a=new s.S;this.inputReports=a,this.device.oninputreport=function(e){if(e.currentTarget===i.device){var n=i.inputReportDescriptors.get(e.reportId);if(n){var r=new s.f.BitView(e.data.buffer);r.bigEndian=!1,Array.from(n.usages.entries(),t.makeWebHidInputReport.bind(i,r)).filter(function(e){return t.compareReportToCachedValue(e,o)}).forEach(function(e){o.set(e.usage,e.value),a.next(e)})}}}}return o(t,null,[{key:"makeWebHidInputReport",value:function(t,n){for(var r=e(n,2),i=r[0],o=r[1],a=o.offset,u=o.size,c=[];u>0;)c.push(t.getBits(a,Math.min(u,8))),a+=8,u-=8;return c=o.onInput(c),new s.I.UsageReport(i,c)}},{key:"compareReportToCachedValue",value:function(e,t){var n=t.get(e.usage);return!n||n.length!==e.value.length||n.some(function(t,n){return e.value[n]!==t})}}]),t}(),d=function(){function e(t){r(this,e),this.report=t}return o(e,[{key:"reportSizeInBits",value:function(){return this.report.fullReportSize}},{key:"reportSizeInBytes",value:function(){return Math.ceil(this.reportSizeInBits()/8)}},{key:"createBitViewIfNeeded",value:function(){if(!this.bitView){var e=this.reportSizeInBytes(),t=new ArrayBuffer(e);this.bitView=new s.f.BitView(t),this.bitView.bigEndian=!1}return this.bitView}},{key:"getUsageInformationOrThrow",value:function(e){if(!this.report.usages.has(e))throw new s.J("Unable to write usage (0x".concat(e.toString(16).padStart(8,"0"),"). It is not known by the device."),s.E.UNEXPECTED_ERROR);return this.report.usages.get(e)}},{key:"writeUsage",value:function(e,t){var n,r,i=this.getUsageInformationOrThrow(e),o=this.createBitViewIfNeeded();if(!i.absolute){var a=(n=o.buffer,r=new ArrayBuffer(n.byteLength),new Uint8Array(r).set(new Uint8Array(n)),r);o=new s.f.BitView(a)}var u=i.offset,c=i.size;return t.forEach(function(e){o.setBits(u,e,c),u+=8,c-=8}),o.buffer}}]),e}(),l=function(){function e(t,n,i){r(this,e),this.device=t,this.outputReports=n,this.outputUsages=i,this.outputCacheByReportId=new Map}return o(e,[{key:"getReportIdForUsage",value:function(e){if(!this.outputUsages.has(e))throw new s.J("Unknown usagePage: 0x".concat(e.toString(16).padStart(8,"0"),"."),s.E.UNEXPECTED_ERROR);return this.outputUsages.get(e)}},{key:"getReportLayoutForReportId",value:function(e){if(!this.outputReports.has(e))throw new s.J("Unknown reportId: ".concat(e,"."),s.E.UNEXPECTED_ERROR);return this.outputReports.get(e)}},{key:"getUsageInReportForUsage",value:function(e){var t=this.getReportIdForUsage(e),n=this.getReportLayoutForReportId(t);if(!n.usages.has(e))throw new s.J("Unknown rawUsage inside ReportLayout: ".concat(e,"."),s.E.UNEXPECTED_ERROR);return n.usages.get(e)}},{key:"getOrCreateCacheForReportId",value:function(e){if(!this.outputCacheByReportId.has(e)){var t=this.getReportLayoutForReportId(e),n=new d(t);this.outputCacheByReportId.set(e,n)}return this.outputCacheByReportId.get(e)}},{key:"sendOutputUsage",value:function(e,t){return(0,s._)(this,void 0,void 0,n().mark(function r(){var i,o,a,s;return n().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=this.getReportIdForUsage(e),o=this.getOrCreateCacheForReportId(i),a=this.getUsageInReportForUsage(e).onOutput(t),s=o.writeUsage(e,a),n.next=3,this.device.sendReport(i,s);case 3:case"end":return n.stop()}},r,this)}))}}]),e}(),v=o(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Map,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,e),this.usages=t,this.fullReportSize=n}),g=function(){function e(t,n,i){r(this,e),this.offset=t,this.size=n,this.absolute=i}return o(e,[{key:"onInput",value:function(e){return e}},{key:"onOutput",value:function(e){return e}}]),e}(),w=function(){function e(t,n,i,o){r(this,e),this.offset=t,this.size=n,this.absolute=i,this.rangeIndex=o}return o(e,[{key:"onInput",value:function(t){if(t.length>1)throw new s.J("Usages of type ".concat(e.name," should not hold more than 1 byte of information."),s.E.UNEXPECTED_ERROR);return t[0]===this.rangeIndex?[1]:[0]}},{key:"onOutput",value:function(t){if(t.length>1)throw new s.J("Usages of type ".concat(e.name," should not hold more than 1 byte of information."),s.E.UNEXPECTED_ERROR);return t[0]>0?[this.rangeIndex]:t}}]),e}(),y=function(){function e(t){r(this,e);var n=new Map;this.buildReportLayouts(t.collections,"input",n),this.inputReports=n,this.inputUsages=e.buildUsageMap(n);var i=new Map;this.buildReportLayouts(t.collections,"output",i),this.outputReports=i,this.outputUsages=e.buildUsageMap(i);var o=new Map;this.buildReportLayouts(t.collections,"feature",o),this.featureReports=o,this.featureUsages=e.buildUsageMap(o)}return o(e,[{key:"buildReportLayouts",value:function(t,n,r){var i=this;t.forEach(function(t){var o;null===(o=e.reportsOfType(t,n))||void 0===o||o.forEach(function(e){var t,n=e.reportId;r.has(n)||r.set(n,new v);var i=r.get(n),o=0;null===(t=e.items)||void 0===t||t.forEach(function(e){var t=e.usages;if(e.isRange){t=[];for(var n=e.usageMinimum;n<=e.usageMaximum;n+=1)t.push(n)}var r,a=o;if(e.isRange&&e.isArray&&(r=1),!(t.length>0&&t.filter(function(e){return i.usages.has(e)}).length===t.length)){t.forEach(function(t){var n;n=r?new w(a,e.reportSize,e.isAbsolute,r):new g(a,e.reportSize,e.isAbsolute),i.usages.set(t,n),r?r+=1:a+=e.reportSize});var s=e.reportCount*e.reportSize;i.fullReportSize+=s,o+=s}})}),t.children&&i.buildReportLayouts(t.children,n,r)})}}],[{key:"buildUsageMap",value:function(e){var t=new Map;return e.forEach(function(e,n){e.usages.forEach(function(e,r){t.set(r,n)})}),t}},{key:"reportsOfType",value:function(e,t){if("input"===t)return e.inputReports;if("output"===t)return e.outputReports;if("feature"===t)return e.featureReports;throw new s.J("Unexpected report type: ".concat(t,"!"),s.E.UNEXPECTED_ERROR)}}]),e}(),R=function(){function e(t,n,i){r(this,e),this.device=t,this.featureReports=n,this.featureUsages=i,this.outputCacheByReportId=new Map}return o(e,[{key:"getReportIdForUsage",value:function(e){if(!this.featureUsages.has(e))throw new s.J("Unknown usagePage: 0x".concat(e.toString(16).padStart(8,"0"),"."),s.E.UNEXPECTED_ERROR);return this.featureUsages.get(e)}},{key:"getReportLayoutForReportId",value:function(e){if(!this.featureReports.has(e))throw new s.J("Unknown reportId: ".concat(e,"."),s.E.UNEXPECTED_ERROR);return this.featureReports.get(e)}},{key:"getUsageInReportForUsage",value:function(e){var t=this.getReportIdForUsage(e),n=this.getReportLayoutForReportId(t);if(!n.usages.has(e))throw new s.J("Unknown rawUsage inside ReportLayout: ".concat(e,"."),s.E.UNEXPECTED_ERROR);return n.usages.get(e)}},{key:"getOrCreateCacheForReportId",value:function(e){if(!this.outputCacheByReportId.has(e)){var t=this.getReportLayoutForReportId(e),n=new d(t);this.outputCacheByReportId.set(e,n)}return this.outputCacheByReportId.get(e)}},{key:"getFeatureUsage",value:function(e){return(0,s._)(this,void 0,void 0,n().mark(function t(){var r,i,o,a,s;return n().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.getReportIdForUsage(e),t.next=3,this.device.receiveFeatureReport(r);case 3:for(i=t.sent,o=this.getUsageInReportForUsage(e),a=[],s=1;s<=Math.ceil(o.size/8);s+=1)a.push(i.getUint8(s));return t.abrupt("return",a);case 8:case"end":return t.stop()}},t,this)}))}},{key:"setFeatureUsage",value:function(e,t){return(0,s._)(this,void 0,void 0,n().mark(function r(){var i,o,a,s;return n().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=this.getReportIdForUsage(e),o=this.getOrCreateCacheForReportId(i),a=this.getUsageInReportForUsage(e).onOutput(t),s=o.writeUsage(e,a),n.next=3,this.device.sendFeatureReport(i,s);case 3:case"end":return n.stop()}},r,this)}))}}]),e}(),k=o(function e(t,n,i,o){r(this,e),this.name=t,this.vid=n,this.pid=i,this.id=o.sessionId;var a=new y(o);this.inputReports=a.inputReports,this.outputReports=a.outputReports,this.featureReports=a.featureReports,this.inputHandler=new p(o,a.inputReports),this.outputHandler=new l(o,a.outputReports,a.outputUsages),this.featureHandler=new R(o,a.featureReports,a.featureUsages)}),b=function(){function e(t,n){r(this,e),this.hid=t,this.broadcastChannel=n,this.deviceAddedSubject=new s.S,this.deviceAdded=this.deviceAddedSubject,this.deviceRemovedSubject=new s.S,this.deviceRemoved=this.deviceRemovedSubject}return o(e,[{key:"setupListeners",value:function(){var e=this;this.hid.onconnect=function(t){return e.onConnect(t)},this.hid.ondisconnect=function(t){return e.onDisconnect(t)},this.broadcastChannel.onmessage=function(){return e.getPairedDevices()}}},{key:"addNewDevice",value:function(t){return(0,s._)(this,void 0,void 0,n().mark(function r(){var i;return n().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.hasGeneratedDeviceId(t)){n.next=2;break}return n.abrupt("return");case 2:if(e.getOrGenerateDeviceId(t),i=new k(t.productName,t.vendorId,t.productId,t),n.t0=t.opened,n.t0){n.next=8;break}return n.next=8,t.open();case 8:this.deviceAddedSubject.next(i);case 9:case"end":return n.stop()}},r,this)}))}},{key:"onConnect",value:function(e){return(0,s._)(this,void 0,void 0,n().mark(function t(){var r=this;return n().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:setTimeout(function(){return(0,s._)(r,void 0,void 0,n().mark(function t(){return n().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.addNewDevice(e.device);case 2:case"end":return t.stop()}},t,this)}))},1e3);case 1:case"end":return t.stop()}},t)}))}},{key:"onDisconnect",value:function(t){var n=e.getOrGenerateDeviceId(t.device);this.deviceRemovedSubject.next(n)}},{key:"getPairedDevices",value:function(){return(0,s._)(this,void 0,void 0,n().mark(function e(){var t=this;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hid.getDevices();case 2:e.sent.forEach(function(e){return(0,s._)(t,void 0,void 0,n().mark(function t(){return n().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.addNewDevice(e);case 2:case"end":return t.stop()}},t,this)}))});case 3:case"end":return e.stop()}},e,this)}))}}],[{key:"hasGeneratedDeviceId",value:function(e){return void 0!==e.sessionId}},{key:"getOrGenerateDeviceId",value:function(t){if(!e.hasGeneratedDeviceId(t)){var n=new s.u(4).toString();return t.sessionId=n,n}return t.sessionId}}]),e}(),m=o(function e(t,n,i,o,a){r(this,e),this.usagePage=t,this.usage=n,this.valueType=i,this.reportType=o,this.reportSize=a}),E=function(){function e(t){r(this,e),this.deviceManagement=t,this.events=new s.S,this.setupDeviceHandler()}return o(e,[{key:"setupDeviceHandler",value:function(){var t=this;this.deviceManagement.deviceAdded.subscribe(function(n){t.events.next({event:"attach",id:n.id,vid:n.vid,pid:n.pid,name:n.name,serialNumber:n.id,descriptor:e.generateDescriptors(n)})}),this.deviceManagement.deviceRemoved.subscribe(function(e){t.events.next({event:"detach",id:e.id})}),this.deviceManagement.onHidInput.subscribe(function(e){t.events.next({event:"hid-input",id:e.deviceId,usagePage:e.usagePage,usage:e.usage,value:1===e.value.length?e.value[0]:e.value})}),this.deviceManagement.onGetFeatureReportResponse.subscribe(function(e){t.events.next({event:"response-hid-feature",token:e.token,value:1===e.value.length?e.value[0]:e.value})})}}],[{key:"generateDescriptors",value:function(t){var n=e.convertReportLayoutsToDescriptors(t.inputReports,"input");return n=(n=n.concat(e.convertReportLayoutsToDescriptors(t.outputReports,"output"))).concat(e.convertReportLayoutsToDescriptors(t.featureReports,"feature"))}},{key:"convertReportLayoutsToDescriptors",value:function(e,t){var n=[];return e.forEach(function(e){e.usages.forEach(function(e,r){var i=h.usagePageFromRaw(r);65280===i&&"output"===t||n.push(new m(i,h.usageFromRaw(r),e.absolute?"absolute":"relative",t,Math.ceil(e.size/8)))})}),n}}]),e}(),I=function(){function e(t,n,i){r(this,e),this.deviceManagement=t,this.callLockManagement=n,this.logger=i,this.gnpLockAcquired=new s.S,this.callLockAcquired=new s.S,this.softphoneInFocus=new s.S,this.events=(0,s.g)(this.gnpLockAcquired.pipe(c(0)),this.callLockAcquired.pipe(c(0)),this.softphoneInFocus)}return o(e,[{key:"onNewSdkInput",value:function(e){var t=this;if(!e.action)throw new s.J("Provided input has no action property.",s.E.UNEXPECTED_ERROR);switch(e.action){case"hid-output":var n=Array.isArray(e.value)?e.value:[e.value];this.deviceManagement.sendOutputUsage(e.id,e.usagePage,e.usage,n);break;case"request-hid-feature":this.deviceManagement.getFeatureUsage(e.id,e.token,e.usagePage,e.usage);break;case"set-hid-feature":var r=Array.isArray(e.value)?e.value:[e.value];this.deviceManagement.setFeatureUsage(e.id,e.usagePage,e.usage,r);break;case"request-gnp-lock":this.gnpLockAcquired.next({event:"response-gnp-lock",token:e.token}),(0,s.l)("GNP lock requested with WebHID backend. This should not happen!",this.logger,s.L.ERROR,s.h.NATIVE_CONSOLE);break;case"release-gnp-lock":break;case"request-call-lock":this.callLockManagement.tryAcquireCallLock(e.id).then(function(n){t.callLockAcquired.next({event:"response-call-lock",id:e.id,acquired:n})});break;case"release-call-lock":this.callLockManagement.releaseCallLock(e.id);break;case"set-softphone-info":this.softphoneInFocus.next({event:"softphone-in-focus",infocus:!1}),this.softphoneInFocus.complete();break;default:throw new s.J("Provided action is not recognized - ".concat(e.action,"."),s.E.UNEXPECTED_ERROR)}}}]),e}(),L=function(){function e(t,n,i){var o=this;r(this,e),this.navigatorLocks=t,this.logger=i,this.releaseGlobalLock=null,this.localLockedDevices=new Set,n.deviceRemoved.subscribe(function(e){o.localLockedDevices.has(e.id)&&o.releaseCallLock(e.id)})}return o(e,[{key:"tryAcquireCallLock",value:function(e){return(0,s._)(this,void 0,void 0,n().mark(function t(){var r=this;return n().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkWebLocksSupport();case 2:if(t.t0=!t.sent,t.t0){t.next=5;break}t.t0=this.localLockedDevices.size>0&&!this.localLockedDevices.has(e)?(this.localLockedDevices.add(e),!0):new Promise(function(t){r.navigatorLocks.request("jabra-call-lock",{ifAvailable:!0},function(n){return n?(r.localLockedDevices.add(e),t(!0),new Promise(function(e){r.releaseGlobalLock=e})):(t(!1),Promise.resolve())})});case 5:return t.abrupt("return",t.t0);case 6:case"end":return t.stop()}},t,this)}))}},{key:"releaseCallLock",value:function(e){this.localLockedDevices.delete(e),this.releaseGlobalLock&&0===this.localLockedDevices.size&&this.releaseGlobalLock()}},{key:"checkWebLocksSupport",value:function(){return(0,s._)(this,void 0,void 0,n().mark(function e(){var t,r=this;return n().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.navigatorLocks.query().catch(function(){(0,s.l)("WebLocks unsupported. The cross-tab call lock is disabled.",r.logger,s.L.WARNING)});case 2:return t=e.sent,e.abrupt("return",Boolean(t));case 4:case"end":return e.stop()}},e,this)}))}}]),e}(),U=function(){function e(t,n,i,o){r(this,e),this.scanner=t,this.deviceEventHandler=n,this.sdkInputEventHandler=i,this.logger=o,this.readyEvent=new s.S,this.events=new s.i,this.events=(0,s.g)(this.readyEvent,this.deviceEventHandler.events,this.sdkInputEventHandler.events)}return o(e,[{key:"start",value:function(){this.readyEvent.next({event:"ready",version:null,jabraDirectInstalled:!1}),this.readyEvent.complete(),this.scanner.getPairedDevices(),this.scanner.setupListeners()}},{key:"sendMessage",value:function(e){var t;null===(t=this.sdkInputEventHandler)||void 0===t||t.onNewSdkInput(e)}}]),e}();function x(e){if("undefined"==typeof window)throw new s.J("WebHID is not supported outside of a browser environment.",s.E.INIT_ERROR);if(void 0===window.navigator||void 0===window.navigator.hid)throw new s.J("WebHID is not supported on this platform/browser.",s.E.INIT_ERROR);if(void 0===window.navigator.locks)throw new s.J("WebLocks is not supported on this platform/browser.",s.E.INIT_ERROR);var t=window.navigator.hid,n=window.navigator.locks,r=new BroadcastChannel(s.j.PAIRING_CHANNEL),i=new b(t,r),o=new f(i),a=new E(o),u=new I(o,new L(n,o,e));return new U(i,a,u,e)}}}])}();