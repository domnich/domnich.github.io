"use strict";(self.webpackChunkcloudya=self.webpackChunkcloudya||[]).push([[68592],{16492:function(t,e,s){s.d(e,{T:function(){return n},l:function(){return o}});var i=s(37716);let n=(()=>{class t{static isString(t){return"string"==typeof t||t instanceof String}static caseInsensitiveSort(e,s){return t.isString(e)&&t.isString(s)?e.localeCompare(s):t.defaultCompare(e,s)}static defaultCompare(t,e){return t===e?0:null==t?1:null==e?-1:t>e?1:-1}static parseExpression(t){return(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split(".")}static getValue(t,e){for(let s=0,i=e.length;s<i;++s){const i=e[s];if(!(i in t))return;t=t[i]}return t}static setValue(t,e,s){let i;for(i=0;i<s.length-1;i++)t=t[s[i]];t[s[i]]=e}transform(t,e,s,i=!1,n){return t&&(Array.isArray(e)?this.multiExpressionTransform(t,e,s,i,n):Array.isArray(t)?this.sortArray(t.slice(),e,s,i,n):"object"==typeof t?this.transformObject(Object.assign({},t),e,s,i,n):t)}sortArray(e,s,i,n,o){const r=s&&-1!==s.indexOf(".");let a;r&&(s=t.parseExpression(s)),a=o&&"function"==typeof o?o:n?t.caseInsensitiveSort:t.defaultCompare;let u=e.sort((e,i)=>s?r?a(t.getValue(e,s),t.getValue(i,s)):e&&i?a(e[s],i[s]):a(e,i):a(e,i));return i?u.reverse():u}transformObject(e,s,i,n,o){let r=t.parseExpression(s),a=r.pop(),u=t.getValue(e,r);return Array.isArray(u)||(r.push(a),a=null,u=t.getValue(e,r)),u&&t.setValue(e,this.transform(u,a,i,n),r),e}multiExpressionTransform(t,e,s,i=!1,n){return e.reverse().reduce((t,e)=>this.transform(t,e,s,i,n),t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=i.Yjl({name:"orderBy",type:t,pure:!1}),t})(),o=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.oAB({type:t}),t.\u0275inj=i.cJS({providers:[n]}),t})()},43982:function(t,e,s){s.d(e,{Q:function(){return C}});var i=s(11740),n=s(28123),o=(()=>{return(t=o||(o={})).Austria="at",t.Belgium="be",t.Bulgaria="bg",t.Switzerland="ch",t.Germany="de",t.Denmark="dk",t.Spain="es",t.France="fr",t.UnitedKingdom="gb",t.Croatia="hr",t.Hungary="hu",t.Ireland="ie",t.India="in",t.Italy="it",t.Netherlands="nl",t.Poland="pl",t.Portugal="pt",t.Romania="ro",t.Sweden="se",t.Slovenia="si",t.USA="us",o;var t})();const r={busy:{busyToneState:!0,volume:.25,busyTones:{gb:{frequency:400,latency:375,autoCloseDuration:4650},de:{frequency:425,latency:480,autoCloseDuration:4525}},currentTone:o.UnitedKingdom,toneSegment:{segmentFrequencies:[950,1400,1800],segmentsDuration:330,segmentsInterval:30}}};var a=s(71188),u=s(46782),c=s(79765),l=s(68260),h=s(37716),d=s(22238),p=s(78023),g=s(29790);let y=(()=>{class t{constructor(t){this.dialogRef=t}closeDialog(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(d.so))},t.\u0275cmp=h.Xpm({type:t,selectors:[["autoplay-policy"]],decls:7,vars:6,consts:[[1,"autoplay-policy__header"],[1,"autoplay-policy__body"],["buttonTextTranslationKey","autoplay_policy.button","type","stroked-button-submit","data-e2e","autoplay-policy-fragment__confirm--button",1,"autoplay-policy__button",3,"appButtonClick"]],template:function(t,e){1&t&&(h.TgZ(0,"div",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"div",1),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"app-button",2),h.NdJ("appButtonClick",function(){return e.closeDialog()}),h.qZA()),2&t&&(h.xp6(1),h.hij(" ",h.lcZ(2,2,"autoplay_policy.title"),"\n"),h.xp6(3),h.hij(" ",h.lcZ(5,4,"autoplay_policy.text"),"\n"))},directives:[p.V],pipes:[g.X$],styles:[".autoplay-policy__header[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:bold}.autoplay-policy__body[_ngcontent-%COMP%]{font-size:1.4rem;margin:1.6rem 0 2.5rem}.autoplay-policy__button[_ngcontent-%COMP%]{float:right}"]}),t})();var m=s(81836),f=s(8225),v=s(51233),b=s(14074),S=s(57158),T=s(45832),x=s(8307),A=s(25791);let C=(()=>{class t{constructor(t,e,s,i,n,o,r,a,u){this.sipService=t,this.devicesService=e,this.userService=s,this.setCallbackOnBusyService=i,this.logger=n,this.dialog=o,this.snackBarService=r,this.router=a,this.guestService=u,this.osc=null,this.audioEl=new Audio,this.ngUnsubscribe=new c.xQ,this.isStoppingSitTone=!1,this.userExtension="",this.currentSegment=0,this.ctx=new(window.AudioContext||window.webkitAudioContext),this.busyToneState=!0,this.msd=this.ctx.createMediaStreamDestination(),this.checkAudioContextState()}ngOnDestroy(){this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}initIncoming(){this.ringtone&&this.isRingTonePlaying()&&this.ringtone.pause(),this.loadRingtone(),a.V.ringerActive&&this.ringtone.play(),this.setCallbackOnBusyService.removeCallbackOnBusy()}openContextAndCreateMsd(){this.ctx=new AudioContext,this.msd=this.ctx.createMediaStreamDestination()}initBusy(t){this.resetBusyTone(),this.openContextAndCreateMsd(),this.busyToneInterval=setInterval(()=>{this.startBusyTone(this.busyToneState)},r.busy.busyTones[r.busy.currentTone].latency),this.userExtension=t,this.busyToneTimeout=setTimeout(()=>{this.resetBusyTone()},r.busy.busyTones[r.busy.currentTone].autoCloseDuration)}initFailure(t,e){this.userExtension=e,this.currentSegment=0,(null==t?void 0:t.statusCode)===l.i.TEMPORARILY_UNAVAILABLE?this.initBusy(this.userExtension):this.startSitTone()}preloadAudio(t=0){const e=["assets/audio/Munich.mp3","assets/audio/call-waiting.wav"],s=new Audio(e[t]),i=()=>{s.removeEventListener("canplaythrough",i),t<=e.length-1&&this.preloadAudio(++t)};s.load(),s.addEventListener("canplaythrough",i,!1)}loadRingtone(){this.ringtone=new Audio,this.ringtone.loop=!0,this.ringtone.src=this.sipService.onGoingCall?"assets/audio/call-waiting.wav":"assets/audio/Munich.mp3",this.ringtone.load(),this.setRingtoneVolumeFromCache(this.ringtone),this.userService.userInfo$.pipe((0,u.R)(this.ngUnsubscribe)).subscribe(t=>{if(t){this.userExtension=t.activePhoneExtension.extensionNumber;const e=this.devicesService.loadStoredRingerOutputDevice();this.logger.info(e),e&&(i.W.attachSinkId(this.ringtone,e.deviceId,this.logger),this.ringtone&&this.setRingtoneVolumeFromCache(this.ringtone))}})}stopRingTone(){this.ringtone.pause()}startBusyTone(t=!0){if(t)this.osc=this.ctx.createOscillator(),this.osc.frequency.setValueAtTime(r.busy.busyTones[r.busy.currentTone].frequency,this.ctx.currentTime),this.setAudioSourceForBusyOrSitTone(),this.osc.start(this.ctx.currentTime);else{if(!this.osc)return;this.osc.stop(this.ctx.currentTime),this.osc=null}this.busyToneState=!this.busyToneState}startSitTone(){var t,e,s;const i=r.busy.toneSegment.segmentFrequencies,n=i[this.currentSegment];this.openContextAndCreateMsd(),this.osc=this.ctx.createOscillator(),null===(e=null===(t=this.osc)||void 0===t?void 0:t.frequency)||void 0===e||e.setValueAtTime(n,this.ctx.currentTime),this.setAudioSourceForBusyOrSitTone(),null===(s=this.osc)||void 0===s||s.start(this.ctx.currentTime),setTimeout(()=>{this.osc&&(this.osc.stop(this.ctx.currentTime),this.osc=null),this.closeAudioContext(),this.currentSegment++,this.currentSegment<i.length&&!this.isStoppingSitTone&&this.startSitTone()},r.busy.toneSegment.segmentsDuration)}stopPlayingSitTone(){this.isStoppingSitTone=!0}closeAudioContext(){this.ctx&&"closed"!==this.ctx.state&&this.ctx.close()}resetBusyTone(){clearInterval(this.busyToneInterval),clearTimeout(this.busyToneTimeout),this.startBusyTone(!1)}setAudioSourceForBusyOrSitTone(){this.osc.connect(this.msd),this.audioEl.srcObject=this.msd.stream,this.setRingtoneVolumeFromCache(this.audioEl,r.busy.volume),this.audioEl.volume=.2,this.audioEl.play();const t=this.devicesService.loadStoredAudioOutputDevice();i.W.attachSinkId(this.audioEl,t?t.deviceId:"",this.logger)}isRingTonePlaying(){return!this.ringtone.paused}setRingtoneVolumeFromCache(t,e){const s=this.devicesService.loadStoredRingerOutputDevice();if(this.logger.info(s),s){const i=n.Q.getCached("ringtoneVolumes-"+this.userExtension,[]);if(i){const n=i.find(t=>t.label===s.label);n&&(t.volume=n.value*(e||1))}}}toggleAutoplayPolicyComponent(){this.dialog.open(y,{width:"28rem",autoFocus:!1,panelClass:"autoplay-policy"}).afterClosed().subscribe(()=>{this.snackBarService.openInfo("autoplay_policy.sound_enabled")})}checkAudioContextState(){const t="localhost"===window.location.hostname,e=this.router.url.includes("login"),s=this.guestService.isGuest();t||e||s||"suspended"===this.ctx.state&&this.toggleAutoplayPolicyComponent()}}return t.\u0275fac=function(e){return new(e||t)(h.LFG(m.y),h.LFG(f.I),h.LFG(v.K),h.LFG(b.q),h.LFG(S.Kf),h.LFG(d.uw),h.LFG(T.c),h.LFG(x.F0),h.LFG(A.Q))},t.\u0275prov=h.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},7685:function(t,e,s){s.d(e,{_:function(){return i}});class i{static password(){return function(t){return t.value&&!t.value.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!"#$%()*+,-./;<@\'_])[A-Za-z\d!"#$%()*+,-./;<@\'_]{8,}$/)?{invalidPassword:!0}:null}}}}}]);